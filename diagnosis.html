<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Analysis of the Input - Master Strategist</title>
  <style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ml5/0.12.2/ml5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ml5/0.12.2/ml5.min.js"></script>
<script>
  // Load the sentiment model on page load
  let sentimentModel;
  window.onload = function () {
    ml5.sentiment('movieReviews').then(model => {
      window.sentimentModel = model;
      console.log("Sentiment model loaded.");
    });
  };
</script>

    /* Global Styles */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body, html { font-family: Arial, sans-serif; background: white; color: #333; padding: 20px; }
    .container { max-width: 900px; margin: 20px auto; padding: 20px; }
    h1, h2 { margin-bottom: 10px; }
    h1 { text-align: center; }
    .section { margin-bottom: 30px; }
    .section h2 { margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
    ul { list-style-type: none; margin-left: 0; }
    ul li { padding: 5px 0; }
    label { cursor: pointer; }
    /* Form Styles */
    form {
      background: #f9f9f9;
      padding: 20px;
      border-radius: 5px;
      margin-bottom: 20px;
      box-shadow: 0 0 6px rgba(0,0,0,0.1);
    }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; font-weight: bold; margin-bottom: 5px; }
    .form-group textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1rem;
      resize: vertical;
    }
    .survey-button, .next-button {
      display: inline-block;
      padding: 12px 25px;
      background-color: blue;
      color: #fff;
      border: none;
      border-radius: 4px;
      text-decoration: none;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .survey-button:hover, .next-button:hover { background-color: darkblue; }
    .result { background: #e7f3ff; border: 1px solid #b3d4fc; padding: 15px; border-radius: 5px; margin-top: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Analysis of Your Input</h1>
    <div class="section">
      <p>Select an item from each category below to help diagnose your challenges. After making your choice, complete the survey to generate a summary analysis.</p>
    </div>
    
    <!-- Categories with Radio Buttons -->
    <div class="section">
      <h2>Needs</h2>
      <ul id="needs-list">
        <li><input type="radio" name="needs" value="Food" id="need-food"><label for="need-food">Food</label></li>
        <li><input type="radio" name="needs" value="Shelter" id="need-shelter"><label for="need-shelter">Shelter</label></li>
        <li><input type="radio" name="needs" value="Sleep" id="need-sleep"><label for="need-sleep">Sleep</label></li>
        <li><input type="radio" name="needs" value="Health Care" id="need-healthcare"><label for="need-healthcare">Health Care</label></li>
        <li><input type="radio" name="needs" value="Hygiene" id="need-hygiene"><label for="need-hygiene">Hygiene</label></li>
        <li><input type="radio" name="needs" value="Social Connections" id="need-social"><label for="need-social">Social Connections</label></li>
        <li><input type="radio" name="needs" value="Emotional Support" id="need-emotional"><label for="need-emotional">Emotional Support</label></li>
        <li><input type="radio" name="needs" value="Self-Esteem" id="need-selfesteem"><label for="need-selfesteem">Self-Esteem</label></li>
      </ul>
    </div>
    
    <div class="section">
      <h2>Wants</h2>
      <ul id="wants-list">
        <li><input type="radio" name="wants" value="Water" id="want-water"><label for="want-water">Water</label></li>
        <li><input type="radio" name="wants" value="Exercise" id="want-exercise"><label for="want-exercise">Exercise</label></li>
        <li><input type="radio" name="wants" value="Comfort" id="want-comfort"><label for="want-comfort">Comfort</label></li>
        <li><input type="radio" name="wants" value="Connection" id="want-connection"><label for="want-connection">Connection</label></li>
        <li><input type="radio" name="wants" value="Validation" id="want-validation"><label for="want-validation">Validation</label></li>
        <li><input type="radio" name="wants" value="Support" id="want-support"><label for="want-support">Support</label></li>
        <li><input type="radio" name="wants" value="Relaxation" id="want-relaxation"><label for="want-relaxation">Relaxation</label></li>
      </ul>
    </div>
    
    <div class="section">
      <h2>Desires</h2>
      <ul id="desires-list">
        <li><input type="radio" name="desires" value="Happiness" id="desire-happiness"><label for="desire-happiness">Happiness</label></li>
        <li><input type="radio" name="desires" value="Purpose" id="desire-purpose"><label for="desire-purpose">Purpose</label></li>
        <li><input type="radio" name="desires" value="Love" id="desire-love"><label for="desire-love">Love</label></li>
        <li><input type="radio" name="desires" value="Friendship" id="desire-friendship"><label for="desire-friendship">Friendship</label></li>
        <li><input type="radio" name="desires" value="Success" id="desire-success"><label for="desire-success">Success</label></li>
      </ul>
    </div>
    
    <div class="section">
      <h2>Necessities</h2>
      <ul id="necessities-list">
        <li><input type="radio" name="necessities" value="Food" id="necessity-food"><label for="necessity-food">Food</label></li>
        <li><input type="radio" name="necessities" value="Shelter" id="necessity-shelter"><label for="necessity-shelter">Shelter</label></li>
        <li><input type="radio" name="necessities" value="Sleep" id="necessity-sleep"><label for="necessity-sleep">Sleep</label></li>
        <li><input type="radio" name="necessities" value="Health Care" id="necessity-healthcare"><label for="necessity-healthcare">Health Care</label></li>
      </ul>
    </div>
    
    <div class="section">
      <h2>Problems and Challenges</h2>
      <ul id="problems-list">
        <li><input type="radio" name="problems" value="Financial Constraints" id="problem-finance"><label for="problem-finance">Financial Constraints</label></li>
        <li><input type="radio" name="problems" value="Food Insecurity" id="problem-food"><label for="problem-food">Food Insecurity</label></li>
        <li><input type="radio" name="problems" value="Sleep Deprivation" id="problem-sleep"><label for="problem-sleep">Sleep Deprivation</label></li>
        <li><input type="radio" name="problems" value="Lack of Access to Health Care" id="problem-health"><label for="problem-health">Lack of Access to Health Care</label></li>
      </ul>
    </div>
    
    <div class="section">
      <h2>Things People Love</h2>
      <ul id="loves-list">
        <li><input type="radio" name="loves" value="Connection" id="love-connection"><label for="love-connection">Connection</label></li>
        <li><input type="radio" name="loves" value="Success" id="love-success"><label for="love-success">Success</label></li>
        <li><input type="radio" name="loves" value="Support" id="love-support"><label for="love-support">Support</label></li>
        <li><input type="radio" name="loves" value="Relaxation" id="love-relaxation"><label for="love-relaxation">Relaxation</label></li>
        <li><input type="radio" name="loves" value="Happiness" id="love-happiness"><label for="love-happiness">Happiness</label></li>
      </ul>
    </div>
    
    <!-- Diagnostic Survey -->
    <div class="section">
      <h2>Diagnostic Survey</h2>
      <form id="diagnosticForm">
        <div class="form-group">
          <label for="challengeDescription">Describe the Nature of Your Challenge:</label>
          <textarea id="challengeDescription" name="challengeDescription" placeholder="What is happening? What are you struggling with?"></textarea>
        </div>
        <div class="form-group">
          <label for="criticalAspects">Key Aspects (Personality/Character, Resources, Focus, & Others):</label>
          <textarea id="criticalAspects" name="criticalAspects" placeholder="What are the critical factors?"></textarea>
        </div>
        <div class="form-group">
          <label for="swotAnalysis">SWOT Analysis (Strengths, Weaknesses, Opportunities, Threats):</label>
          <textarea id="swotAnalysis" name="swotAnalysis" placeholder="Briefly describe your SWOT analysis"></textarea>
        </div>
        <div class="form-group">
          <label for="environment">Environmental & Situational Awareness:</label>
          <textarea id="environment" name="environment" placeholder="Describe your current environment and circumstances"></textarea>
        </div>
        <div class="form-group">
          <label for="insights">Your Insights & Potential New Strengths:</label>
          <textarea id="insights" name="insights" placeholder="What insights have you discovered?"></textarea>
        </div>
        <button type="button" class="survey-button" onclick="generateAnalysis()">Generate Analysis</button>
<button type="button" class="generate-button" onclick="generateEnhancedDiagnosis()">Generate Enhanced Diagnosis</button>
      </form>
    </div>
    
    <!-- Analysis Result -->
    <div id="result" class="result" style="display: none;"></div>
    
    <!-- Navigation -->
    <div class="section" style="text-align: center;">
      <a href="guiding_policy.html" class="next-button">Proceed to Next Stage</a>
    </div>
  </div>
  
  <script>
    function generateAnalysis() {
      const getSelected = (name) => {
        const radios = document.getElementsByName(name);
        for (let radio of radios) {
          if (radio.checked) return radio.value;
        }
        return 'Not specified';
      };
      
      const selectedNeed = getSelected("needs");
      const selectedWant = getSelected("wants");
      const selectedDesire = getSelected("desires");
      const selectedNecessity = getSelected("necessities");
      const selectedProblem = getSelected("problems");
      const selectedLove = getSelected("loves");
      
      const challengeDescription = document.getElementById("challengeDescription").value || "Not provided";
      const criticalAspects = document.getElementById("criticalAspects").value || "Not provided";
      const swotAnalysis = document.getElementById("swotAnalysis").value || "Not provided";
      const environment = document.getElementById("environment").value || "Not provided";
      const insights = document.getElementById("insights").value || "Not provided";
      
      const analysisText = `
        <h2>Diagnostic Analysis</h2>
        <p><strong>Your Selection Summary:</strong></p>
        <ul>
          <li><strong>Need:</strong> ${selectedNeed}</li>
          <li><strong>Want:</strong> ${selectedWant}</li>
          <li><strong>Desire:</strong> ${selectedDesire}</li>
          <li><strong>Necessity:</strong> ${selectedNecessity}</li>
          <li><strong>Problem/Challenge:</strong> ${selectedProblem}</li>
          <li><strong>Things You Love:</strong> ${selectedLove}</li>
        </ul>
        <p><strong>Challenge Description:</strong> ${challengeDescription}</p>
        <p><strong>Critical Aspects (You / Focus / Others):</strong> ${criticalAspects}</p>
        <p><strong>SWOT Analysis:</strong> ${swotAnalysis}</p>
        <p><strong>Environmental & Situational Awareness:</strong> ${environment}</p>
        <p><strong>Your Insights & Potential Strengths:</strong> ${insights}</p>
        <p>This diagnostic summary simplifies your complex reality into critical aspects, identifying potential advantages and revealing areas for strategic action.</p>
      `;
      
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = analysisText;
      resultDiv.style.display = "block";
    }
  </script>
<div id="diagnosisOutput"></div>
<script>
  // New upgraded functionality: Enhanced Diagnosis using ml5 Sentiment Analysis.
  function generateEnhancedDiagnosis() {
    // Retrieve the same form fields as your existing code.
    const challenge = document.getElementById('challengeDescription').value || "No challenge description provided.";
    const aspects = document.getElementById('criticalAspects').value || "No key aspects provided.";
    const env = document.getElementById('environment').value || "No environmental details provided.";
    const insights = document.getElementById('insights').value || "No insights provided.";

    // Use ml5.js for sentiment analysis.
    // Ensure the sentiment model is loaded (ml5.sentiment has been loaded already).
    if (window.sentimentModel) {
      const prediction = window.sentimentModel.predict(challenge);
      const sentimentScore = prediction.score;

      // Generate auto insights incorporating sentiment.
      let enhancedInsights = "<p><strong>Enhanced Auto-generated Insights:</strong></p>";
      if (sentimentScore < 0.4) {
          enhancedInsights += "<p>Your challenge sentiment is negative, suggesting high stress or potential issues that need addressing.</p>";
      } else if (sentimentScore < 0.6) {
          enhancedInsights += "<p>The sentiment is neutral; consider adding more detail for a deeper analysis.</p>";
      } else {
          enhancedInsights += "<p>The sentiment is positive, which may indicate underlying strengths you can leverage.</p>";
      }
      // Example heuristic adjustments (feel free to tweak these):
      if (challenge.length < 50) {
          enhancedInsights += "<p>Your challenge description is brief—more detail might help in identifying critical aspects.</p>";
      }
      // Append additional comparisons with existing input, if needed.
      
      // Now, combine this enhanced insight with your original diagnosis summary.
      const enhancedSummary = `
        <p><strong>Challenge:</strong> ${challenge}</p>
        <p><strong>Key Aspects:</strong> ${aspects}</p>
        <p><strong>Environment:</strong> ${env}</p>
        <p><strong>Insights:</strong> ${insights}</p>
        ${enhancedInsights}
      `;
      
      // Display the enhanced diagnosis result in an additional container, or append to your existing output.
      const diagnosisOutput = document.getElementById('diagnosisOutput');
      diagnosisOutput.innerHTML += enhancedSummary;

      // Save enhanced data (if desired) in localStorage, for later stages
      let diagnosisData = localStorage.getItem('diagnosisData') ? JSON.parse(localStorage.getItem('diagnosisData')) : {};
      diagnosisData.enhancedSummary = enhancedSummary;
      localStorage.setItem('diagnosisData', JSON.stringify(diagnosisData));
    } else {
      console.log("Sentiment model not loaded yet.");
    }
  }

  // Optionally, create a new button for the enhanced diagnosis so you can test it without disrupting the original.
  // For example, you can add this code at the end of your form.
  const enhancedBtn = document.createElement("button");
  enhancedBtn.textContent = "Generate Enhanced Diagnosis";
  enhancedBtn.className = "generate-button";
  enhancedBtn.onclick = generateEnhancedDiagnosis;
  document.getElementById("diagnosisForm").appendChild(enhancedBtn);

  // Also, ensure the ml5 sentiment model is loaded once and stored globally.
  ml5.sentiment('movieReviews')
    .then(model => {
      // Save this model in a global variable so the upgraded function can use it.
      window.sentimentModel = model;
      console.log("Enhanced Sentiment Model Loaded");
    })
    .catch(err => {
      console.error("Error loading enhanced sentiment model:", err);
    });
<script>
  // Function to append the comprehensive diagnosis description
  function appendDiagnosisDescription() {
    const descriptionText = `
      <h3>Diagnosis Description</h3>
      <p>
        A diagnosis that defines or explains the nature of the challenge. A good diagnosis simplifies
        the often overwhelming complexity of reality by identifying certain aspects of the situation as critical.
        A diagnosis names or classifies the situation, linking facts into patterns and suggesting that more attention 
        be paid to some issues and less to others. An especially insightful diagnosis can transform one’s view of the 
        situation, bringing a radically different perspective to bear. When a diagnosis classifies the situation as 
        a certain type, it opens access to knowledge about how analogous situations were handled in the past. An explicit 
        diagnosis permits one to evaluate the rest of the strategy.
      </p>
    `;
    // Append this description to the output area (diagnosisOutput)
    const outputContainer = document.getElementById('diagnosisOutput');
    if (outputContainer) {
      outputContainer.innerHTML += descriptionText;
    }
  }

  // Call this function at the end of your enhanced diagnosis function.
  // For example, in your generateEnhancedDiagnosis() function, after saving and displaying the summary,
  // add the line:
  //    appendDiagnosisDescription();

  // If you prefer to have it automatically appended when the page loads (or the diagnosis is generated),
  // you can call it from within generateEnhancedDiagnosis(), like so:
  function generateEnhancedDiagnosis() {
    // [Your existing enhanced diagnosis code...]
    // --- Start of your current code ---
    const challenge = document.getElementById('challengeDescription').value || "No challenge description provided.";
    const aspects = document.getElementById('criticalAspects').value || "No key aspects provided.";
    const env = document.getElementById('environment').value || "No environmental details provided.";
    const insights = document.getElementById('insights').value || "No insights provided.";

    if (window.sentimentModel) {
      const prediction = window.sentimentModel.predict(challenge);
      const sentimentScore = prediction.score;
      let enhancedInsights = "<p><strong>Enhanced Auto-generated Insights:</strong></p>";
      if (sentimentScore < 0.4) {
        enhancedInsights += "<p>Your challenge sentiment is negative, suggesting high stress or potential issues that need addressing.</p>";
      } else if (sentimentScore < 0.6) {
        enhancedInsights += "<p>The sentiment is neutral; consider adding more detail for a deeper analysis.</p>";
      } else {
        enhancedInsights += "<p>The sentiment is positive, which may indicate underlying strengths you can leverage.</p>";
      }
      if (challenge.length < 50) {
        enhancedInsights += "<p>Your challenge description is brief—more detail might help in identifying critical aspects.</p>";
      }
      const enhancedSummary = `
         <p><strong>Challenge:</strong> ${challenge}</p>
         <p><strong>Key Aspects:</strong> ${aspects}</p>
         <p><strong>Environment:</strong> ${env}</p>
         <p><strong>Insights:</strong> ${insights}</p>
         ${enhancedInsights}
      `;
      const diagnosisOutput = document.getElementById('diagnosisOutput');
      diagnosisOutput.innerHTML += enhancedSummary;
      let diagnosisData = localStorage.getItem('diagnosisData') ? JSON.parse(localStorage.getItem('diagnosisData')) : {};
      diagnosisData.enhancedSummary = enhancedSummary;
      localStorage.setItem('diagnosisData', JSON.stringify(diagnosisData));
    } else {
      console.log("Sentiment model not loaded yet.");
    }
    // ----- Now append the diagnosis description text -----
    appendDiagnosisDescription();
  }
  <button onclick="runDiagnosis()">Run Diagnosis</button>
<pre id="output"></pre>
<script>
async function runDiagnosis() {
  const payload = {
    challenge: document.getElementById('challenge').value,
    aspects:  document.getElementById('aspects').value,
    env:       document.getElementById('env').value,
    insights:  document.getElementById('insights').value
  };
  const res = await fetch('/.netlify/functions/diagnose', {
    method: 'POST', body: JSON.stringify(payload)
  });
  const data = await res.json();
  document.getElementById('output').innerText = JSON.stringify(data, null,2);
  localStorage.setItem('diagnosisData', JSON.stringify(data));
}
  <script>
async function callDiagnosisFunction() {
  const challenge = document.getElementById("challengeDescription").value;
  const aspects = document.getElementById("criticalAspects").value;
  const env = document.getElementById("environment").value;
  const insights = document.getElementById("insights").value;

  const payload = { challenge, aspects, env, insights };

  try {
    const response = await fetch("/.netlify/functions/diagnose", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(payload)
    });

    const data = await response.json();

    // Display the dynamic results
    document.getElementById("diagnosisOutput").innerHTML = `
      <h3>Diagnosis Summary</h3>
      <p><strong>Sentiment Score:</strong> ${data.sentiment}</p>
      <p><strong>Keywords:</strong> ${data.keywords.join(", ")}</p>
      <p><strong>SWOT Analysis:</strong></p>
      <ul>
        <li><strong>Strengths:</strong> ${data.swot.strengths}</li>
        <li><strong>Weaknesses:</strong> ${data.swot.weaknesses}</li>
        <li><strong>Opportunities:</strong> ${data.swot.opportunities}</li>
        <li><strong>Threats:</strong> ${data.swot.threats}</li>
      </ul>
      <p><strong>Original Inputs:</strong></p>
      <p><em>Challenge:</em> ${data.summary.challenge}</p>
      <p><em>Key Aspects:</em> ${data.summary.aspects}</p>
      <p><em>Environment:</em> ${data.summary.environment}</p>
      <p><em>Insights:</em> ${data.summary.insights}</p>
    `;

    // Optional: Save to localStorage for later stages
    localStorage.setItem("diagnosisData", JSON.stringify(data));

  } catch (error) {
    console.error("Error calling diagnosis function:", error);
    document.getElementById("diagnosisOutput").innerHTML = "Something went wrong. Try again.";
  }
  <button onclick="callDiagnosisFunction()">Run Strategic Diagnosis</button>
<div id="diagnosisOutput"></div>

}
</script>

</script>
  

</script>
</script>
</body>
</html>
